# MovieFlow Constitution

## 核心原则

### I. 场景驱动开发
每个视频功能必须从具体场景出发，明确目标受众和传播目的。功能设计必须服务于视频叙事，而非技术实现。所有功能必须能够通过视觉化方式呈现效果。

### II. 模块化生成
视频生成采用6×10秒分段策略，每个片段独立生成但保持整体一致性。模块间通过标准接口通信，支持并行处理和失败重试。每个模块必须定义清晰的输入输出格式。

### III. 测试优先（NON-NEGOTIABLE）
所有视频生成功能必须遵循TDD原则：
1. 先编写视觉效果验证测试
2. 测试通过用户确认
3. 测试确认失败（Red phase）
4. 实现功能使测试通过

### IV. 质量保证体系
每个生成的视频片段必须经过质量检查：
- 时长准确性（±0.5秒容差）
- 分辨率一致性
- 音视频同步
- 内容安全审核

### V. API优先设计
所有功能必须先定义API合约，包括：
- 请求/响应格式
- 错误码定义
- 重试策略
- 超时设置
每个API必须支持异步任务模式。

### VI. 可观测性
所有视频生成过程必须可追踪：
- 任务状态实时更新
- 生成进度百分比
- 错误日志详细记录
- 性能指标监控

### VII. 简约原则
- 初始实现最多3个核心服务（生成器、合成器、管理器）
- 避免过度抽象，直接使用火山引擎和Gemini API
- 不预设未来需求，按需迭代

### VIII. 平台适配
视频输出必须适配主流短视频平台：
- 抖音：9:16竖屏，1080×1920
- 视频号：支持1:1和9:16
- 快手：竖屏优先
所有输出必须包含平台特定的元数据。

### IX. 成本控制
每次API调用必须记录成本：
- 火山引擎按帧计费
- Gemini按图片计费
- 实施调用频率限制
- 提供成本预估功能

## 技术约束

### 依赖管理
- 核心依赖：火山引擎SDK、Gemini API、FFmpeg
- 开发依赖：TypeScript、Jest、ESLint
- 避免引入非必要依赖

### 性能要求
- 单个10秒片段生成时间 < 60秒
- 60秒完整视频生成时间 < 5分钟
- API响应时间p95 < 500ms
- 并发任务数 ≤ 3

### 安全规范
- API密钥必须通过环境变量配置
- 实施内容安全检测
- 用户数据不得持久化超过7天
- 生成内容添加水印标识

## 开发流程

### 需求规格化
1. 使用 `/specify` 命令创建功能规格
2. 明确用户故事和验收标准
3. 标记所有待澄清项 [NEEDS CLARIFICATION]

### 技术规划
1. 使用 `/plan` 命令生成实施计划
2. 选择合适的API和技术栈
3. 设计数据模型和API合约

### 任务分解
1. 使用 `/tasks` 命令分解任务
2. 标记可并行任务 [P]
3. 确保测试任务优先

### 实施验证
1. 执行quickstart.md验证核心功能
2. 运行集成测试套件
3. 进行平台兼容性测试

## 治理规则

### 文档要求
- 所有API必须有完整文档
- 每个功能必须包含使用示例
- 错误处理必须有详细说明

### 代码审查
- PR必须包含测试覆盖率报告
- 性能影响必须评估记录
- 破坏性变更需要迁移计划

### 版本管理
- 遵循语义化版本（MAJOR.MINOR.PATCH）
- API变更必须向后兼容
- 废弃功能保留至少2个版本

### 合规性检查
所有生成内容必须符合：
- 平台内容政策
- 版权保护要求
- 用户隐私协议
- 地区法律法规

## 修订流程

本宪章的修改需要：
1. 明确的变更理由文档
2. 项目维护者审核批准
3. 向后兼容性评估
4. 用户影响分析报告

**版本**: 1.0.0 | **批准日期**: 2024-09-20 | **最后修订**: 2024-09-20